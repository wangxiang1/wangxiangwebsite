<!--
 * @Author: wangxiang
 * @Date: 2022-03-01 11:21:39
 * @LastEditTime: 2022-03-01 11:24:50
 * @LastEditors: wangxiang
 * @Description: 研发环境
 * @FilePath: /wangxiangwebsite/docs/研发环境.md
-->
# 远程研发工具webssh-数据域

## 1. 天宫webssh订购

用户登录天宫后，在顶部导航中找到【产品】栏，点击【远程研发工具webssh-数据域】产品：

 ![图片 5](/img/webssh/图片 5.png)

在实例列表页面点击【新建】，进入webssh产品的订购页面：

 ![图片 6](/img/webssh/图片 6.png)

在订购页面中，按需自主订购webssh产品，可自主选择所需CPU、内存（存储默认为30G系统盘+50G数据盘）：

 ![图片 7](/img/webssh/图片 7.png)

## 2.  天宫webssh产品管理

用户订购webssh产品后，会自动跳转到webssh产品的实例列表页面，可通过点击页面中的“刷新”按钮，获取最新状态的webssh虚拟机。同时，可在实例列表页面对其进行启停、资源配额调整、退订等操作管理。

 ![图片 8](/img/webssh/图片 8.png)

### 2.1天宫webssh启停

状态为“运行中”的webssh虚拟机，可通过操作栏中的“停止”操作，对webssh虚拟机进行关机；

状态为“关机”的webssh虚拟机，可通过操作栏中的“启动”操作，对webssh虚拟机进行开机。

 ![图片 9](/img/webssh/图片 9.png)

### 2.2天宫webssh资源调整

状态为“关机”的webssh虚拟机，可通过操作栏中的“调整资源”操作，对webssh虚拟机进行资源（CPU、内存）调整。

![图片 10](/img/webssh/图片 10.png)

## 3. 天宫webssh产品使用

### 3.1初始化票据-上传/下载文件

当webssh虚拟机的状态为“运行中”时，可通过操作栏中的“详情”操作，进入webssh实例详情：

![图片 11](/img/webssh/图片 11.png)

点击左侧【上传/下载文件】栏，找到/home/dev目录（注意该页面上传文件的权限为dev用户，只有/home/dev目录有上传文件权限），点击“上传”按钮，将用户的keytab文件（票据）上传到webssh虚拟机：

![图片 12](/img/webssh/图片 12.png)

![图片 13](/img/webssh/图片 13.png)

### 3.2初始化票据-Terminal终端

上述票据上传完成后，进入webssh的terminal终端进行票据解压：

 ![图片 14](/img/webssh/图片 14.png)

进入“/home/dev”目录并解压票据zip包：

```
[dev@odatancmp-pxqbmmfr ~]$ sudo yum  install unzip -y 
... 
[dev@odatancmp-pxqbmmfr ~]$ cd /home/dev 
[dev@odatancmp-pxqbmmfr ~]$ ls  
code-server log.log   logs   zb_zhw_yw_odatatest_keytab.zip  
[dev@odatancmp-pxqbmmfr ~]$ unzip  zb_zhw_yw_odatatest_keytab.zip 
```

  初始化租户票据（初始化票据过程稍慢，请耐心等待）：

```
[dev@odatancmp-pxqbmmfr ~]$ kinit zb_zhw_yw_odatatest@ODATA.NCMP.UNICOM.LOCAL -kt zb_zhw_yw_odatatest.keytab 
```

![图片 15](/img/webssh/图片 15.png)

### 3.3 初始化环境

默认登陆自动初始化yarn2 

**初始化yarn1**

source /opt/beh/conf/yarn1/yarn1_env.sh

**初始化 yarn2**

source /opt/beh/conf/yarn2/yarn2_env.sh

**初始化 yarn3**

source /opt/beh/conf/yarn3/yarn3_env.sh

以下说明以yarn2为例:

### 3.4 Hive使用-Terminal终端

（1）用户进行初始化票据之后，可通过beeline连接访问底座Hive集群：

```
beeline -u 'jdbc:hive2://x86-gx-0008.odata.ncmp.unicom.local:2181,x86-gx-0009.odata.ncmp.unicom.local:2181,x86-gx-0010.odata.ncmp.unicom.local:2181/;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2'
```

 **//yarn2**

 **注**：

  ①  **//yarn1** 

```
beeline -u  'jdbc:hive2://arm-gx-0008.odata.ncmp.unicom.local:2181,arm-gx-0009.odata.ncmp.unicom.local:2181,arm-gx-0010.odata.ncmp.unicom.local:2181/;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2'
```

 ②  **//yarn3** 

```
beeline -u  'jdbc:hive2://x86-gx-0664.odata.ncmp.unicom.local:2181,x86-gx-0665.odata.ncmp.unicom.local:2181,x86-gx-0666.odata.ncmp.unicom.local:2181/;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2' 
```

  ③   **//yarn4** 

```
beeline -u 'jdbc:hive2://x86-gx-1306.odata.ncmp.unicom.local:2181,x86-gx-1307.odata.ncmp.unicom.local:2181,x86-gx-1308.odata.ncmp.unicom.local:2181/;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2'  
```

 ![图片 16](/img/webssh/图片 16.png)

(2)查询数据库列表

```
  [dev@odatancmp-pxqbmmfr ~]$ show databases；  
```

 ![图片 17](/img/webssh/图片 17.png)

(3)设置相应队列,执行相应语句.

### 3.5 Spark使用-Terminal终端

```
[dev@odatancmp-pxqbmmfr  ~]$spark-submit --class org.apache.spark.examples.SparkPi --queue default  --master yarn  --deploy-mode cluster  --num-executors 10  /opt/beh/core/spark/examples/jars/spark-examples_2.12-3.1.1.jar  
```

![图片 18](/img/webssh/图片 18.png)

### 3.6 Flink使用-Terminal终端

```
[dev@odatancmp-pxqbmmfr  ~]$ flink run -m yarn-cluster -yqu default -yD  security.kerberos.login.use-ticket-cache=true  /opt/beh/core/flink/examples/batch/WordCount.jar
```

  

![图片 19](/img/webssh/图片 19.png)

### 3.7 mr使用-Terminal终端

```
[dev@odatancmp-pxqbmmfr~]$  hadoop jar  $HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar pi  -Dmapreduce.job.queuename=default 10 10 
```

 

 ![图片 20](/img/webssh/图片 20.png)

### 3.8开发平台（vscode）

用户在左侧【webssh概览】页面点击“开发平台”： ![图片 21](/img/webssh/图片 21.png)

进入vscode页面：

  ![图片 22](/img/webssh/图片 22.png)

在vscode页面中，点击左侧上方栏目进入开发平台页面：

![图片 23](/img/webssh/图片 23.png)

初始化环境(参考3.3章节)以及票据后，可正常访问集群，使用方式同上述各个组件方式（以mapreduce为例）：

![图片 24](/img/webssh/图片 24.png)

### 3.9 home目录下创建一个和dev同级的目录

  1.首先利用python获取加密密码： 

```
[dev@wdhtest2-yoerls8l ~]$ python
Python 2.7.5 (default, Nov 16 2020, 22:23:17) 
[GCC 4.8.5 20150623 (Red Hat 4.8.5-44)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
\>>> import crypt
\>>> print crypt.crypt('test3','12')
12/8YkHioExfE
\>>>quit()
```

其中 12/8YkHioExfE 为 test3 加密后的密文 

2.新建用户，执行：  sudo useradd <用户> -p <加密后密码>  

3.删除误增的用户：  sudo userdel <用户>  

4.登陆用户：  su - <用户>  

5.上传文件到该用户目录下：  利用xshell或者其它软件，使用sftp协议，根据ssh信息连接上传文件即可。        

### 3.10 webssh连presto(pod1)使用-Terminal终端

```
[dev@odatancmp-pxqbmmfr  ~]$ more test.sh
#!/bin/bash 
/opt/beh/core/hetu/bin/hetu-cli \
  --server  https://arm-gx-0111.odata.ncmp.unicom.local:7778 \
  --krb5-config-path /home/dev/krb5.conf \
  --krb5-principal  zb_zhw_yw_odatatest@ODATA.NCMP.UNICOM.LOCAL \
  --krb5-keytab-path  /home/dev/zb_zhw_yw_odatatest.keytab \
  --krb5-service-principal-pattern  HTTP@x86-rt-0828.odata.ncmp.unicom.local \
  --krb5-remote-service-name HTTP \
  --keystore-path  /opt/keystore/pod1/hadoop.keystore \
  --keystore-password hadoop
```

![图片 25](/img/webssh/图片 25.png)

```
 [dev@odatancmp-pxqbmmfr  ~]$ sh test.sh
 lk>  show catalogs;
```

![图片 26](/img/webssh/图片 26.png)

```
lk> show schemas from  hive_arm;
```

![图片 27](/img/webssh/图片 27.png)

```
lk>use hive_arm.test; 
lk:dlw> show tables;
lk:test> select * from  Table limit 1;
```

  ![图片 28](/img/webssh/图片 28.png)

### 3.11 本地vscode免密配置

打开命令窗口cmd

执行ping 172.24.123.21,查看网络是否可达，网络没问题再往下执行

1、点击下载按钮，出现选项，根据自身系统选择需要下载的脚本，windows系统选择windos，mac系统选择mac。

![图片 29](/img/webssh/图片 29.png)

2、下载完成之后解压run.zip 

![图片 30](/img/webssh/图片 30.png)

3、（win系统）解压完成之后里面包含三个文件，首先看下Readme.txt看电脑是否满足运行脚本条件，如果满足，双击run.exe，运行时间较长，请耐心等待。

  （mac系统）解压完成后也是三个文件，和windows不通的是run代替了run.exe，打开终端terminal，进入run脚本所在目录，执行：./run就可以运行



![图片 31](/img/webssh/图片 31.png)

 ![图片 32](/img/webssh/图片 32.png)

执行脚本的注意事项：

脚本一定要执行完毕，脚本出现如下框内内容才能退出

![图片33](/img/webssh/图片33.png)